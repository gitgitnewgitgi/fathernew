# Enable URL rewriting
RewriteEngine On

# Default index files
DirectoryIndex index.php index.html

# âœ… Slug redirect: /f/kalhyge/anything â†’ /f/index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^f/([^/]+)/?.*$ /f/index.php [L,QSA]

# âœ… Final slug redirect: /fina/slug/anything â†’ /fina/index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^fina/([^/]+)/?.*$ /fina/index.php [L,QSA]

# ðŸ”’ Disable directory listing
Options -Indexes

# ðŸ”’ Block access to sensitive backend files
<FilesMatch "\.(env|log|ini|bak|sh|yml|json|lock|Dockerfile|dockerignore|gitignore|htaccess)$">
  Require all denied
</FilesMatch>

# â›” Block direct access to hidden/internal folders
RedirectMatch 403 ^/.data
RedirectMatch 403 ^/ogas
RedirectMatch 403 ^/api
RedirectMatch 403 ^/Dockerfile

# âœ… Secure headers
<IfModule mod_headers.c>
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set X-Content-Type-Options "nosniff"
  Header always set Referrer-Policy "no-referrer-when-downgrade"
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=(), fullscreen=*"
  Header always set Cross-Origin-Embedder-Policy "require-corp"
  Header always set Cross-Origin-Opener-Policy "same-origin"
  Header always set Cross-Origin-Resource-Policy "same-origin"
  Header always set X-Permitted-Cross-Domain-Policies "none"
  Header set Content-Security-Policy "default-src 'self'; img-src 'self' data:; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; font-src 'self' data:;"
</IfModule>
